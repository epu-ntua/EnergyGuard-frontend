{% extends "core/authenticated-base.html" %}
{% load static %}

{% block title %}EnergyGuard | Project Details{% endblock %}

{% block content %}

<div class="content px-0 pt-navbar">
  <div class="row g-0">
    <div class="col-12 col-xxl-8 px-0 bg-body mx-auto">
      <div class="px-4 px-lg-6 pt-6 pb-9">
        <div class="mb-5">
          <div class="d-flex justify-content-between">
            <h2 class="text-body-emphasis fw-bolder mb-2">{{ project_details.name }}</h2>

            <!-- TODO: Replace 3 Dots above graph -->
            <div class="btn-reveal-trigger">
              <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal" type="button"
                data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false"
                data-bs-reference="parent"><span class="fas fa-ellipsis-h"></span></button>
              <div class="dropdown-menu dropdown-menu-end py-2">
                <a class="dropdown-item" href="{% url 'add_experiment' project_details.id %}">Add experiment</a>
                <form action="{% url 'delete_project' project_details.id %}" method="post" class="m-0 p-0">
                  {% csrf_token %}
                  <button class="dropdown-item text-danger" type="submit">Delete project</button>
                </form>
              </div>
            </div>
          </div>

        </div>
        <div class="row gx-0 gx-sm-5 gy-3 mb-8">
          <!-- Details -->
          <div class="col-12 col-xl-3 col-xxl-4 pe-xl-0">
            <div class="mb-4 mb-xl-7">
              <div class="row gx-0 gx-sm-7">
                <div class="col-12 col-sm-auto">
                  <table class="lh-sm mb-4 mb-sm-0 mb-xl-4">
                    <tbody>
                      <tr>
                        <td class="py-1" colspan="2">
                          <div class="d-flex"><span class="fa-solid fa-earth-americas me-2 text-body-tertiary fs-9"></span>
                            <h5 class="text-body">{% if project_details.visibility %}Public{% else %}Private{% endif %} Project</h5>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="align-top py-1">
                          <div class="d-flex"><span class="fa-solid fa-user me-2 text-body-tertiary fs-9"></span>
                            <h5 class="text-body mb-0 text-nowrap">Team :</h5>
                          </div>
                        </td>
                        <!-- <td class="ps-1 py-1"><a class="fw-semibold d-block lh-sm" href="#!">{{ project_details.company|default:"-"}} </a></td> -->
                        <td class="ps-1 py-1 text-start fw-semibold lh-sm d-block">{{ project_details.team|default:"-"}}</td>
                      </tr>

                      <!-- TODO: Replace with real data -->
                      <!-- <tr>
                        <td class="align-top py-1">
                          <div class="d-flex"><span
                              class="fa-regular fa-credit-card me-2 text-body-tertiary fs-9"></span>
                            <h5 class="text-body mb-0 text-nowrap">Budget : </h5>
                          </div>
                        </td>
                        <td class="fw-bold ps-1 py-1 text-body-highlight">$8,742</td>
                      </tr> -->
                    </tbody>
                  </table>
                </div>
                <div class="col-12 col-sm-auto">
                  <table class="lh-sm">
                    <tbody>
                      <tr>
                        <td class="align-top py-1 text-body text-nowrap fw-bold">Started : </td>
                        <td class="text-body-tertiary text-opacity-85 fw-semibold ps-3">{{ project_details.start_date|date:"M j, Y" }}</td>
                      </tr>
                      <tr>
                        <td class="align-top py-1 text-body text-nowrap fw-bold">Last run :</td>
                        <td class="text-body-tertiary text-opacity-85 fw-semibold ps-3">{{ project_details.last_update|date:"M j, Y"|default:"-" }}</td>
                      </tr>
                      <tr>
                        <td class="align-top py-1 text-body text-nowrap fw-bold">Type :</td>
                        <td class="text-warning text-opacity-85 fw-semibold ps-3">{{ project_details.type }}</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="col-12 col-sm-auto">
                  <a href="https://jupyterhub.energy-guard.eu/" target="_blank" rel="noopener noreferrer">
                    <button class="btn btn-primary mt-1" style="width:80%;" type="button">Open in Jupyter</button>
                  </a>
                  <a href="{% url 'add_experiment' project_details.id %}">
                    <button class="btn btn-success mt-1" style="width:80%;" type="button">Add Experiment</button>
                  </a>
                  <!-- TODO: Add project's mlflow link -->
                  <a href="{% if project_details.mlflow_experiment_id %}https://mlflow.energy-guard.eu/#/experiments/{{ project_details.mlflow_experiment_id }}{% else %}#{% endif %}" target="_blank">
                    <button class="btn btn-purple mt-1" style="width:80%;" type="button">Open in MLFlow</button>
                  </a>
                </div>

              </div>
            </div>
            
          </div>
          <!-- Main graph -->
          <div class="col-12 col-xl-9 col-xxl-8">
            <div class="row flex-between-center mb-3 g-3">
              <div class="col-auto">
                <h4 class="text-body-emphasis">GPU usage over time</h4>
                <p class="text-body-tertiary mb-0">Overall GPU usage last month</p>
              </div>
              <div class="col-8 col-sm-4">
                <select class="form-select form-select-sm">
                  <option>Mar 1 - 31, 2022</option>
                  <option>April 1 - 30, 2022</option>
                  <option>May 1 - 31, 2022</option>
                </select>
              </div>
            </div>
            <div class="echart-completed-task-chart" style="min-height:200px;width:100%"></div>
            <div class="mt-4 text-end">
              <a href="#"><button type="button" class="btn btn-purple p-1">View usage statistics</button></a>
            </div>
          </div>
          <!-- Trustworthy graph -->
          <div class="col-12 col-sm-5 col-lg-4 col-xl-3 col-xxl-4">
            <div class="mb-5">
              <h4 class="text-body-emphasis">Trustworthy Assessment</h4>
              <!-- TODO: Update text with db data -->
              <h6 class="text-body-tertiary">Last review in 12 September 2025</h6>
            </div>
            <div class="echart-top-coupons mb-5" style="height:115px;width:100%;"></div>
            <div class="row justify-content-center">
              <div class="col-auto col-sm-12">
                <div class="row justify-content-center justify-content-sm-between g-5 g-sm-0 mb-2">
                  <div class="col">
                    <div class="d-flex align-items-center">
                      <div class="bullet-item me-2 bg-primary"></div>
                      <h6 class="text-body fw-semibold flex-1 mb-0">Cybersecurity</h6>
                    </div>
                  </div>
                  <div class="col-auto">
                    <h6 class="text-body fw-semibold mb-0">72%</h6>
                  </div>
                </div>
                <div class="row justify-content-center justify-content-sm-between g-5 g-sm-0 mb-2">
                  <div class="col">
                    <div class="d-flex align-items-center">
                      <div class="bullet-item me-2 bg-primary-lighter"></div>
                      <h6 class="text-body fw-semibold flex-1 mb-0">Explainability</h6>
                    </div>
                  </div>
                  <div class="col-auto">
                    <h6 class="text-body fw-semibold mb-0">18%</h6>
                  </div>
                </div>
                <div class="row justify-content-center justify-content-sm-between g-5 g-sm-0 mb-2">
                  <div class="col">
                    <div class="d-flex align-items-center">
                      <div class="bullet-item me-2 bg-info"></div>
                      <h6 class="text-body fw-semibold flex-1 mb-0">Bias</h6>
                    </div>
                  </div>
                  <div class="col-auto">
                    <h6 class="text-body fw-semibold mb-0">10%</h6>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Collaborators -->
          <div class="col-12 col-sm-7 col-lg-8 col-xl-5">
            <h4 class="text-body-emphasis mb-4">Collaborators</h4>
            <div class="d-flex mb-8">

              <!-- Collaborators' icons -->

              {% for collaborator in project_details.collaborators %}
              <div class="dropdown"><a class="dropdown-toggle dropdown-caret-none d-inline-block outline-none" href="#"
                  role="button" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                  <div class="avatar avatar-xl  me-1">
                    {% with pic=collaborator.profile.profile_picture %}
                      {% if pic %}
                        <img class="rounded-circle" src="{{ pic }}" alt="{{ collaborator.get_full_name|default:collaborator.email }}">
                      {% else %}
                        <img class="rounded-circle" src="{% static 'assets/img/team/33.webp' %}" alt="Default avatar">
                      {% endif %}
                    {% endwith %}
                  </div>
                </a>
              </div>
              {% endfor %}
            </div>

            <h4 class="text-body-emphasis mb-4">Tags</h4>
            {% if experiments and experiments.0.tags %}
              {% for tag_key, tag_value in experiments.0.tags.items %}
                <span class="badge badge-tag me-2 mb-1">{{ tag_key }}{% if tag_value != "true" %}: {{ tag_value }}{% endif %}</span>
              {% endfor %}
            {% else %}
              <span class="text-body-tertiary">No tags available.</span>
            {% endif %}
          </div>
        </div>
        <div class="d-flex flex-between-center align-items-center mb-3 mt-6">
          <h3 class="text-body-emphasis mb-0">Experiments</h3>
          <a class="btn btn-sm btn-outline-primary" href="{% url 'experiments_list' project_details.id %}">View All</a>
        </div>
        <div class="table-responsive border rounded-3 mb-6">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Open in MLflow</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for experiment in experiments|slice:":10" %}
                <tr>
                  <td>{{ experiment.name }}</td>
                  <td>{{ experiment.description|default:"-" }}</td>
                  <td>
                    <a
                      class="btn btn-sm btn-outline-primary"
                      href="{% if experiment.mlflow_experiment_id %}https://mlflow.energy-guard.eu/#/experiments/{{ experiment.mlflow_experiment_id }}{% else %}#{% endif %}"
                      target="_blank"
                      {% if not experiment.mlflow_experiment_id %}aria-disabled="true"{% endif %}
                    >
                      Open in MLflow
                    </a>
                  </td>
                  <td class="text-end">
                    <div class="dropdown">
                      <button
                        class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal"
                        type="button"
                        data-bs-toggle="dropdown"
                        data-boundary="window"
                        aria-haspopup="true"
                        aria-expanded="false"
                      >
                        <span class="fas fa-ellipsis-h fs-10"></span>
                      </button>
                      <div class="dropdown-menu dropdown-menu-end py-2">
                        <a class="dropdown-item" href="{% url 'edit_experiment' project_details.id experiment.id %}">Edit experiment</a>
                        <a class="dropdown-item" href="{% url 'eval_results' project_details.id experiment.id %}" target="_blank">Eval results</a>
                        <form action="{% url 'delete_experiment' project_details.id experiment.id %}" method="post">
                          {% csrf_token %}
                          <button type="submit" class="dropdown-item text-danger">Delete experiment</button>
                        </form>
                      </div>
                    </div>
                  </td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="text-body-tertiary">No experiments yet.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <h3 class="text-body-emphasis mb-4">Project overview</h3>
        <p class="text-body-secondary mb-4 text-justify">
          {{ project_details.description }}
          <!-- <a class="fw-semibold" href="#!">read more</a> -->
        </p>
      </div>
    </div>

    <!-- Recent activity and files -->
    <!-- <div class="col-12 col-xxl-4 px-0 border-start-xxl border-top-sm">
      <div class="bg-light dark__bg-gray-1100 h-100">
        <div class="p-4 p-lg-6">
          <h3 class="text-body-highlight mb-4 fw-bold">Recent activity</h3>
          <div class="timeline-vertical timeline-with-details">
            <div class="timeline-item position-relative">
              <div class="row g-md-3">
                <div class="col-12 col-md-auto d-flex">
                  <div class="timeline-item-date order-1 order-md-0 me-md-4">
                    <p class="fs-10 fw-semibold text-body-tertiary text-opacity-85 text-end">01 DEC, 2023<br
                        class="d-none d-md-block" /> 10:30 AM</p>
                  </div>
                  <div class="timeline-item-bar position-md-relative me-3 me-md-0">
                    <div class="icon-item icon-item-sm rounded-7 shadow-none bg-primary-subtle"><span
                        class="fa-solid fa-chess text-primary-dark fs-10"></span></div><span
                      class="timeline-bar border-end border-dashed"></span>
                  </div>
                </div>
                <div class="col">
                  <div class="timeline-item-content ps-6 ps-md-3">
                    <h5 class="fs-9 lh-sm">Phoenix Template: Unleashing Creative Possibilities</h5>
                    <p class="fs-9">by <a class="fw-semibold" href="#!">Shantinon Mekalan</a></p>
                    <p class="fs-9 text-body-secondary mb-5">Discover limitless creativity with the Phoenix
                      template! Our latest update offers an array of innovative features and design options.</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="timeline-item position-relative">
              <div class="row g-md-3">
                <div class="col-12 col-md-auto d-flex">
                  <div class="timeline-item-date order-1 order-md-0 me-md-4">
                    <p class="fs-10 fw-semibold text-body-tertiary text-opacity-85 text-end">05 DEC, 2023<br
                        class="d-none d-md-block" /> 12:30 AM</p>
                  </div>
                  <div class="timeline-item-bar position-md-relative me-3 me-md-0">
                    <div class="icon-item icon-item-sm rounded-7 shadow-none bg-primary-subtle"><span
                        class="fa-solid fa-dove text-primary-dark fs-10"></span></div><span
                      class="timeline-bar border-end border-dashed"></span>
                  </div>
                </div>
                <div class="col">
                  <div class="timeline-item-content ps-6 ps-md-3">
                    <h5 class="fs-9 lh-sm">Empower Your Digital Presence: The Phoenix Template Unveiled</h5>
                    <p class="fs-9">by <a class="fw-semibold" href="#!">Bookworm22</a></p>
                    <p class="fs-9 text-body-secondary mb-5">Unveiling the Phoenix template, a game-changer for your
                      digital presence. With its powerful features and sleek design,</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="timeline-item position-relative">
              <div class="row g-md-3">
                <div class="col-12 col-md-auto d-flex">
                  <div class="timeline-item-date order-1 order-md-0 me-md-4">
                    <p class="fs-10 fw-semibold text-body-tertiary text-opacity-85 text-end">15 DEC, 2023<br
                        class="d-none d-md-block" /> 2:30 AM</p>
                  </div>
                  <div class="timeline-item-bar position-md-relative me-3 me-md-0">
                    <div class="icon-item icon-item-sm rounded-7 shadow-none bg-primary-subtle"><span
                        class="fa-solid fa-dungeon text-primary-dark fs-10"></span></div>
                  </div>
                </div>
                <div class="col">
                  <div class="timeline-item-content ps-6 ps-md-3">
                    <h5 class="fs-9 lh-sm">Phoenix Template: Simplified Design, Maximum Impact</h5>
                    <p class="fs-9">by <a class="fw-semibold" href="#!">Sharuka Nijibum</a></p>
                    <p class="fs-9 text-body-secondary mb-0">Introducing the Phoenix template, where simplified
                      design meets maximum impact. Elevate your digital presence with its sleek and intuitive
                      features.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="px-4 px-lg-6">
          <h4 class="mb-3">Files</h4>
        </div>
        <div class="border-top px-4 px-lg-6 py-4">
          <div class="me-n3">
            <div class="d-flex flex-between-center">
              <div class="d-flex mb-1"><span class="fa-solid fa-image me-2 text-body-tertiary fs-9"></span>
                <p class="text-body-highlight mb-0 lh-1">Silly_sight_1.png</p>
              </div>
              <div class="btn-reveal-trigger">
                <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal" type="button"
                  data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false"
                  data-bs-reference="parent"><span class="fas fa-ellipsis-h"></span></button>
                <div class="dropdown-menu dropdown-menu-end py-2"><a class="dropdown-item" href="#!">Edit</a><a
                    class="dropdown-item text-danger" href="#!">Delete</a><a class="dropdown-item"
                    href="#!">Download</a><a class="dropdown-item" href="#!">Report abuse</a></div>
              </div>
            </div>
            <div class="d-flex fs-9 text-body-tertiary mb-2 flex-wrap"><span>768 kb</span><span
                class="text-body-quaternary mx-1">| </span><a href="#!">Shantinan Mekalan </a><span
                class="text-body-quaternary mx-1">| </span><span class="text-nowrap">21st Dec, 12:56 PM</span></div>
            <img class="rounded-2" src="../../assets/img/generic/40.png" alt="" style="width:320px" />
          </div>
        </div>
        <div class="border-top px-4 px-lg-6 py-4">
          <div class="me-n3">
            <div class="d-flex flex-between-center">
              <div>
                <div class="d-flex align-items-center mb-1"><span
                    class="fa-solid fa-image me-2 fs-9 text-body-tertiary"></span>
                  <p class="text-body-highlight mb-0 lh-1">All_images.zip</p>
                </div>
                <div class="d-flex fs-9 text-body-tertiary mb-0 flex-wrap"><span>12.8 mb</span><span
                    class="text-body-quaternary mx-1">| </span><a href="#!">Yves Tanguy </a><span
                    class="text-body-quaternary mx-1">| </span><span class="text-nowrap">19th Dec, 08:56 PM</span>
                </div>
              </div>
              <div class="btn-reveal-trigger">
                <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal" type="button"
                  data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false"
                  data-bs-reference="parent"><span class="fas fa-ellipsis-h"></span></button>
                <div class="dropdown-menu dropdown-menu-end py-2"><a class="dropdown-item" href="#!">Edit</a><a
                    class="dropdown-item text-danger" href="#!">Delete</a><a class="dropdown-item"
                    href="#!">Download</a><a class="dropdown-item" href="#!">Report abuse</a></div>
              </div>
            </div>
          </div>
        </div>
        <div class="border-top px-4 px-lg-6 py-4 ">
          <div class="me-n3">
            <div class="d-flex flex-between-center">
              <div>
                <div class="d-flex align-items-center mb-1 flex-wrap"><span
                    class="fa-solid fa-file-lines me-2 fs-9 text-body-tertiary"></span>
                  <p class="text-body-highlight mb-0 lh-1">Project.txt</p>
                </div>
                <div class="d-flex fs-9 text-body-tertiary mb-0 flex-wrap"><span>123 kb</span><span
                    class="text-body-quaternary mx-1">| </span><a href="#!">Shantinan Mekalan </a><span
                    class="text-body-quaternary mx-1">| </span><span class="text-nowrap">12th Dec, 12:56 PM</span>
                </div>
              </div>
              <div class="btn-reveal-trigger">
                <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal" type="button"
                  data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false"
                  data-bs-reference="parent"><span class="fas fa-ellipsis-h"></span></button>
                <div class="dropdown-menu dropdown-menu-end py-2"><a class="dropdown-item" href="#!">Edit</a><a
                    class="dropdown-item text-danger" href="#!">Delete</a><a class="dropdown-item"
                    href="#!">Download</a><a class="dropdown-item" href="#!">Report abuse</a></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div> -->

  </div>
  {% include "core/footer.html" %}
</div>
{% endblock %}

{% block scripts %}
<!-- TODO: Remove when real data graphs are added -->
<script src="{% static 'assets/js/pages/project-details.js' %}"></script>
<script src="{% static 'vendors/echarts/echarts.min.js' %}"></script>
{% endblock %}
