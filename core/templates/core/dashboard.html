{% extends "core/authenticated-base.html" %}
{% load static %}

{% block title %}Dashboard | EnergyGuard{% endblock title %}

{% block content %}
<div class="content">

  <!-- TITLE -->
  <div class="row gy-3 mb-6 justify-content-between">
    <div class="col-md-9 col-auto">
      <h2 class="mb-2 text-body-emphasis">Projects Dashboard</h2>
      <h5 class="text-body-tertiary fw-semibold">A snapshot of whatâ€™s available across the EnergyGuard platform</h5>
    </div>
  </div>

  <!-- 1ST LEVEL CARDS -->
  <div class="row mb-5 gy-6">
    <div class="col-12 col-xxl-2">
      <div class="row align-items-center g-3 g-xxl-0 h-100 align-content-between">
        
        <!-- PROJECTS -->
        <div class="col-12 col-sm-6 col-md-3 col-lg-6 col-xl-3 col-xxl-12">
          <div class="d-flex align-items-center"><span class="fs-4 lh-1 uil uil-books text-primary-dark"></span>
            <div class="ms-2">
              <div class="d-flex align-items-end">
                <h2 class="mb-0 me-2">32</h2><span class="fs-7 fw-semibold text-body">Projects</span>
              </div>
              <p class="text-body-secondary fs-9 mb-0">Created in the platform</p>
            </div>
          </div>
        </div>
        <!-- DATASETS -->
        <div class="col-12 col-sm-6 col-md-3 col-lg-6 col-xl-3 col-xxl-12">
          <div class="d-flex align-items-center"><span class="fs-4 lh-1 uil uil-invoice text-warning-dark"></span>
            <div class="ms-2">
              <div class="d-flex align-items-end">
                <h2 class="mb-0 me-2">23</h2><span class="fs-7 fw-semibold text-body">Datasets</span>
              </div>
              <p class="text-body-secondary fs-9 mb-0">Ready to explore</p>
            </div>
          </div>
        </div>
        <!-- AI MODELS -->
        <div class="col-12 col-sm-6 col-md-3 col-lg-6 col-xl-3 col-xxl-12">
          <div class="d-flex align-items-center"><span class="fs-4 lh-1 uil uil-refresh text-danger-dark"></span>
            <div class="ms-2">
              <div class="d-flex align-items-end">
                <h2 class="mb-0 me-2">3</h2><span class="fs-7 fw-semibold text-body">AI Models</span>
              </div>
              <p class="text-body-secondary fs-9 mb-0">Registered & deployable</p>
            </div>
          </div>
        </div>
        <!-- DTs -->
        <div class="col-12 col-sm-6 col-md-3 col-lg-6 col-xl-3 col-xxl-12">
          <div class="d-flex align-items-center"><span class="fs-4 lh-1 uil uil-users-alt text-success-dark"></span>
            <div class="ms-2">
              <div class="d-flex align-items-end">
                <h2 class="mb-0 me-2">94</h2><span class="fs-7 fw-semibold text-body">Digital Twins</span>
              </div>
              <p class="text-body-secondary fs-9 mb-0">Configured & accessible</p>
              <p class="text-body-secondary fs-9 mb-0">Connected to datasets/models</p>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="col-12 col-xl-6 col-xxl-5">
      <h3 class="text-body-emphasis mb-1">Datasets Coverage by Domain</h3>
      <div class="fs-8">Distribution of datasets currently available on the platform</div>
      <div id="sortedBarChart" style="height: 420px;"></div>
    </div>
    {{ chart_data|json_script:"sorted-bar-data" }}
    
    <!-- <div class="col-12 col-xl-6 col-xxl-5">
      <div class="mx-xxl-0">
        <h3>Project: zero Roadmap</h3>
        <p class="text-body-tertiary">Phase 2 is now ongoing</p>
        <div class="gantt-zero-roadmap">
          <div class="row g-2 flex-between-center mb-3">
            <div class="col-12 col-sm-auto">
              <div class="d-flex">
                <div class="d-flex align-items-end me-3">
                  <label class="form-check-label mb-0 me-2 lh-1 text-body" for="progress">Progress</label>
                  <div class="form-check form-switch min-h-auto mb-0">
                    <input class="form-check-input" id="progress" type="checkbox" checked="" data-gantt-progress="data-gantt-progress" />
                  </div>
                </div>
                <div class="d-flex align-items-end flex-1">
                  <label class="form-check-label mb-0 me-2 lh-1 text-body" for="links">Links</label>
                  <div class="form-check form-switch min-h-auto flex-1 mb-0">
                    <input class="form-check-input" id="links" type="checkbox" checked="" data-gantt-links="data-gantt-links" />
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-auto">
              <div class="btn-group" role="group" data-gantt-scale="data-gantt-scale">
                <input class="btn-check" id="weekView" type="radio" name="scaleView" value="week" checked="" />
                <label class="btn btn-phoenix-secondary bg-body-highlight-hover fs-10 py-1 mb-0" for="weekView">Week</label>
                <input class="btn-check" id="monthView" type="radio" name="scaleView" value="month" />
                <label class="btn btn-phoenix-secondary bg-body-highlight-hover fs-10 py-1 mb-0" for="monthView">Month</label>
                <input class="btn-check" id="yearView" type="radio" name="scaleView" value="year" />
                <label class="btn btn-phoenix-secondary bg-body-highlight-hover fs-10 py-1 mb-0" for="yearView">Year</label>
              </div>
            </div>
          </div>
          <div class="gantt-zero-roadmap-chart"></div>
        </div>
      </div>
    </div> -->
    
    <!-- CARD -->
    <div class="col-12 col-xl-6 col-xxl-5">
      <div class="card border h-100 w-100 overflow-hidden">
        {% static 'assets/img/spot-illustrations/32.png' as ill_32 %}
        <div class="bg-holder d-block bg-card" style="background-image:url('{{ ill_32 }}');background-position: top right;">
        </div>
        <!--/.bg-holder-->

        <div class="d-dark-none">
          {% static 'assets/img/spot-illustrations/dark_32.png' as dark_ill_32 %}
          <div class="bg-holder d-none d-sm-block d-xl-none d-xxl-block bg-card" style="background-image:url('{{ dark_ill_32 }}');background-position: bottom right; background-size: auto;">
          </div>
          <!--/.bg-holder-->
        </div>
        <div class="d-light-none">
          {% static 'assets/img/spot-illustrations/dark_21.png' as dark_ill_21 %}
          <div class="bg-holder d-none d-sm-block d-xl-none d-xxl-block bg-card" style="background-image:url('{{ dark_ill_21 }}');background-position: bottom right; background-size: auto;">
          </div>
          <!--/.bg-holder-->
        </div>
        <div class="card-body px-5 position-relative">
          <div class="badge badge-phoenix fs-10 badge-phoenix-warning mb-4"><span class="fw-bold">Trustworthiness</span><span class="fa-solid fa-award ms-1"></span></div>
          <h3 class="mb-5">Trustworthiness assessments</h3>
          <p class="text-body-tertiary fw-semibold">Assess AI Models and Digital Twins <br class="d-none d-sm-block" />across key trust dimensions (e.g., robustness, <br class="d-none d-sm-block" />explainability, safety checks).</p>
          <ul class="mb-4">
            <li class="ls-2 mb-1"><span class="fw-bold">8 </span> Different Benchmarks</li>
            <li class="ls-2">Man in the loop</li>
          </ul>
          <div class="py-0  z-1 ">
            <button class="btn btn-outline-primary p-2">Learn how trustworthiness works<i class="fa-solid fa-angle-right ms-2"></i></button>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- 2ND LEVEL CARDS -->
  <!-- <div class="mx-n4 px-4 mx-lg-n6 px-lg-6 bg-body-emphasis pt-7 pb-3 border-y">
    <div class="row">
      <div class="col-12 col-xl-7 col-xxl-6">
        <div class="row g-3 mb-3">
          <div class="col-12 col-md-6">
            <h3 class="text-body-emphasis text-nowrap">Issues Discovered</h3>
            <p class="text-body-tertiary mb-md-7">Newly found and yet to be solved</p>
            <div class="d-flex align-items-center justify-content-between">
              <p class="mb-0 fw-bold">Issue type </p>
              <p class="mb-0 fs-9">Total count <span class="fw-bold">257</span></p>
            </div>
            <hr class="bg-body-secondary mb-2 mt-2" />
            <div class="d-flex align-items-center mb-1"><span class="d-inline-block bg-info-light bullet-item me-2"></span>
              <p class="mb-0 fw-semibold text-body lh-sm flex-1">Product design</p>
              <h5 class="mb-0 text-body">78</h5>
            </div>
            <div class="d-flex align-items-center mb-1"><span class="d-inline-block bg-warning-light bullet-item me-2"></span>
              <p class="mb-0 fw-semibold text-body lh-sm flex-1">Development</p>
              <h5 class="mb-0 text-body">63</h5>
            </div>
            <div class="d-flex align-items-center mb-1"><span class="d-inline-block bg-danger-light bullet-item me-2"></span>
              <p class="mb-0 fw-semibold text-body lh-sm flex-1">QA &amp; Testing</p>
              <h5 class="mb-0 text-body">56</h5>
            </div>
            <div class="d-flex align-items-center mb-1"><span class="d-inline-block bg-success-light bullet-item me-2"></span>
              <p class="mb-0 fw-semibold text-body lh-sm flex-1">Customer queries</p>
              <h5 class="mb-0 text-body">36</h5>
            </div>
            <div class="d-flex align-items-center"><span class="d-inline-block bg-primary bullet-item me-2"></span>
              <p class="mb-0 fw-semibold text-body lh-sm flex-1">R &amp; D</p>
              <h5 class="mb-0 text-body">24</h5>
            </div>
            <button class="btn btn-outline-primary mt-5">See Details<span class="fas fa-angle-right ms-2 fs-10 text-center"></span></button>
          </div>
          <div class="col-12 col-md-6">
            <div class="position-relative mb-sm-4 mb-xl-0">
              <div class="echart-issue-chart" style="min-height:390px;width:100%"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-xl-5 col-xxl-6">
        <h3>Project: eleven Progress</h3>
        <p class="text-body-tertiary mb-0 mb-xl-3">Deadline &amp; progress</p>
        <div class="echart-zero-burnout-chart" style="min-height:320px;width:100%"></div>
      </div>
    </div>
  </div> -->



  <!-- 3RD LEVEL CARDS -->
  <div class="mx-lg-n4 mt-3 mb-5">
    <div class="row g-3">
      <div class="col-12 col-xl-6 col-xxl-7">
        <div class="card todo-list h-100">
          <div class="card-header border-bottom-0 pb-0">
            <div class="row justify-content-between align-items-center mb-4">
              <div class="col-auto">
                <h3 class="text-body-emphasis">AI Models Inventory</h3>
                <p class="mb-2 mb-md-0 mb-lg-2 text-body-tertiary">How registered models are distributed by model type</p>
              </div>
            </div>
          </div>
          <div class="card-body py-0 scrollbar to-do-list-body">
            
          </div>
          <div class="card-footer border-0"><a class="fw-bold fs-9 mt-4" href="#!">Explore AI Models<span class="fas fa-angle-right ms-2 fs-10 text-center"></span></a></div>
        </div>
      </div>


      <div class="col-12 col-xl-6 col-xxl-5">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title mb-1">
              <h3 class="text-body-emphasis">HPC Availability</h3>
            </div>
            <p class="text-body-tertiary mb-4">Compute resources available for training, simulation and evaluation workloads</p>
            
            


          </div>
        </div>
      </div>
    </div>
  </div>
  

  {% include 'core/footer.html' %}
</div>

{% endblock content %}

{% block scripts %}

<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<script>
am5.ready(function() {
  var data = JSON.parse(document.getElementById("sorted-bar-data").textContent || "[]").map(function(item) {
    return {
      category: item.category,
      value: Number(item.value) || 0
    };
  });

  var root = am5.Root.new("sortedBarChart");
  root.setThemes([am5themes_Animated.new(root)]);

  var chart = root.container.children.push(am5xy.XYChart.new(root, {
    panX: false,
    panY: false,
    wheelX: "none",
    wheelY: "none",
    paddingLeft: 0
  }));
  chart.zoomOutButton.set("forceHidden", true);

  var yRenderer = am5xy.AxisRendererY.new(root, {
    minGridDistance: 30,
    minorGridEnabled: true
  });
  yRenderer.grid.template.set("location", 1);

  var yAxis = chart.yAxes.push(am5xy.CategoryAxis.new(root, {
    maxDeviation: 0,
    categoryField: "category",
    renderer: yRenderer,
    tooltip: am5.Tooltip.new(root, { themeTags: ["axis"] })
  }));

  var xAxis = chart.xAxes.push(am5xy.ValueAxis.new(root, {
    maxDeviation: 0,
    min: 0,
    numberFormatter: am5.NumberFormatter.new(root, {
      numberFormat: "#,###"
    }),
    extraMax: 0.1,
    renderer: am5xy.AxisRendererX.new(root, {
      strokeOpacity: 0.1,
      minGridDistance: 80
    })
  }));

  var series = chart.series.push(am5xy.ColumnSeries.new(root, {
    name: "Datasets",
    xAxis: xAxis,
    yAxis: yAxis,
    valueXField: "value",
    categoryYField: "category",
    tooltip: am5.Tooltip.new(root, {
      pointerOrientation: "left",
      labelText: "{categoryY}: {valueX}"
    })
  }));

  series.columns.template.setAll({
    cornerRadiusTR: 5,
    cornerRadiusBR: 5,
    strokeOpacity: 0
  });

  series.columns.template.adapters.add("fill", function(fill, target) {
    return chart.get("colors").getIndex(series.columns.indexOf(target));
  });

  series.columns.template.adapters.add("stroke", function(stroke, target) {
    return chart.get("colors").getIndex(series.columns.indexOf(target));
  });

  yAxis.data.setAll(data);
  series.data.setAll(data);

  function getSeriesItem(category) {
    for (var i = 0; i < series.dataItems.length; i++) {
      var dataItem = series.dataItems[i];
      if (dataItem.get("categoryY") === category) {
        return dataItem;
      }
    }
    return null;
  }

  function sortCategoryAxis() {
    series.dataItems.sort(function(x, y) {
      return x.get("valueX") - y.get("valueX");
    });

    am5.array.each(yAxis.dataItems, function(dataItem) {
      var seriesDataItem = getSeriesItem(dataItem.get("category"));
      if (seriesDataItem) {
        var index = series.dataItems.indexOf(seriesDataItem);
        var deltaPosition = (index - dataItem.get("index", 0)) / series.dataItems.length;
        dataItem.set("index", index);
        dataItem.set("deltaPosition", -deltaPosition);
        dataItem.animate({
          key: "deltaPosition",
          to: 0,
          duration: 700,
          easing: am5.ease.out(am5.ease.cubic)
        });
      }
    });

    yAxis.dataItems.sort(function(x, y) {
      return x.get("index") - y.get("index");
    });
  }

  sortCategoryAxis();

  chart.set("cursor", am5xy.XYCursor.new(root, {
    behavior: "none",
    xAxis: xAxis,
    yAxis: yAxis
  }));

  series.appear(1000);
  chart.appear(1000, 100);
});
</script>

{% endblock scripts %}
